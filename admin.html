<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFT Tournament Admin Panel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            min-height: 100vh;
        }

        .admin-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .form-input {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn-primary {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }

        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-row {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: #f9fafb;
        }

        .result-row.has-error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .result-row {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <!-- Notification Area -->
        <div id="notification" class="notification"></div>

        <!-- Authentication Overlay -->
        <div id="authOverlay" class="auth-overlay">
            <div class="admin-card p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-center mb-6">Admin Login</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="username" value="admin" class="form-input" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="password" value="admin123" class="form-input" required>
                    </div>
                    <button type="submit" class="btn-primary w-full">Login</button>
                </form>
                <p class="text-sm text-gray-500 text-center mt-4">Default: admin / admin123</p>
            </div>
        </div>

        <!-- Main Admin Panel -->
        <div id="adminPanel" class="hidden">
            <!-- Header -->
            <div class="bg-white shadow-sm">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <h1 class="text-xl font-bold text-gray-900">TFT Tournament Admin Panel</h1>
                        <div class="flex items-center space-x-4">
                            <div id="loadingIndicator" class="hidden">
                                <div class="loading-spinner"></div>
                            </div>
                            <span id="adminStatus" class="text-green-600 font-medium">âœ“ Logged In</span>
                            <button onclick="logout()" class="btn-secondary">Logout</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="admin-grid grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    <!-- Tournament Management -->
                    <div class="admin-card">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-semibold">Tournament Management</h2>
                        </div>
                        <div class="p-6">
                            <form id="tournamentForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tournament Name</label>
                                    <input type="text" id="tournamentName" placeholder="TFT Championship 2025" class="form-input" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="tournamentDescription" placeholder="Tournament description..." rows="3" class="form-input"></textarea>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                                        <input type="date" id="startDate" class="form-input" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                                        <input type="date" id="endDate" class="form-input" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Format</label>
                                        <select id="tournamentFormat" class="form-input">
                                            <option value="checkmate">Checkmate</option>
                                            <option value="standard">Standard</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                        <select id="tournamentStatus" class="form-input">
                                            <option value="upcoming">Upcoming</option>
                                            <option value="live">Live</option>
                                            <option value="completed">Completed</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary">Create Tournament</button>
                            </form>
                        </div>
                    </div>

                    <!-- Player Management -->
                    <div class="admin-card">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-semibold">Player Management</h2>
                        </div>
                        <div class="p-6">
                            <form id="playerForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                    <input type="text" id="playerUsername" placeholder="dishsoap" class="form-input" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
                                    <input type="text" id="playerDisplayName" placeholder="dishsoap" class="form-input" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Region</label>
                                    <select id="playerRegion" class="form-input">
                                        <option value="NA">North America</option>
                                        <option value="EU">Europe</option>
                                        <option value="KR">Korea</option>
                                        <option value="CN">China</option>
                                        <option value="OCE">Oceania</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Discord Tag</label>
                                    <input type="text" id="playerDiscord" placeholder="player#1234" class="form-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Twitch Username</label>
                                    <input type="text" id="playerTwitch" placeholder="player_tv" class="form-input">
                                </div>
                                <button type="submit" class="btn-primary">Add Player</button>
                            </form>
                        </div>
                    </div>

                    <!-- Lobby Management -->
                    <div class="admin-card">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-semibold">Lobby Management</h2>
                        </div>
                        <div class="p-6">
                            <form id="lobbyForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lobby Name</label>
                                    <input type="text" id="lobbyName" placeholder="Lobby A" class="form-input" required>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tournament</label>
                                        <select id="lobbyTournament" class="form-input">
                                            <option value="1">TFT World Championship 2025</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Game Number</label>
                                        <input type="number" id="lobbyGameNumber" min="1" max="6" value="1" class="form-input" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select id="lobbyStatus" class="form-input">
                                        <option value="waiting">Waiting</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn-primary">Create Lobby</button>
                            </form>
                        </div>
                    </div>

                    <!-- Game Results Submission -->
                    <div class="admin-card">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-xl font-semibold">Submit Game Results</h2>
                        </div>
                        <div class="p-6">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Select Lobby</label>
                                <select id="resultsLobby" class="form-input">
                                    <option value="">Select a lobby...</option>
                                    <option value="1">Lobby A - Game 1</option>
                                    <option value="2">Lobby B - Game 1</option>
                                </select>
                            </div>
                            
                            <div id="resultsContainer" class="space-y-3">
                                <!-- Results will be dynamically added -->
                            </div>
                            
                            <div class="flex gap-3 mt-4">
                                <button onclick="addResultRow()" class="btn-secondary">Add Player Result</button>
                                <button onclick="submitResults()" class="btn-primary">Submit All Results</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Players List -->
                <div class="admin-card mt-8">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold">Current Players</h2>
                    </div>
                    <div class="p-6">
                        <div id="playersTable" class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Player</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Region</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Discord</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Twitch</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="playersTableBody" class="divide-y divide-gray-200">
                                    <!-- Players will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Current Lobbies List -->
                <div class="admin-card mt-8">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-xl font-semibold">Current Lobbies</h2>
                    </div>
                    <div class="p-6">
                        <div id="lobbiesTable" class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Lobby</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tournament</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Game</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="lobbiesTableBody" class="divide-y divide-gray-200">
                                    <!-- Lobbies will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'https://tft-tournament-tracker-dev.kay-e1e.workers.dev';
        let authToken = null;
        let currentPlayers = [];
        let currentLobbies = [];

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showLoading(show = true) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
        }

        async function makeAPIRequest(endpoint, options = {}) {
            showLoading(true);
            try {
                const headers = {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` }),
                    ...options.headers
                };

                const response = await fetch(`${API_BASE}${endpoint}`, {
                    ...options,
                    headers
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                showLoading(false);
                return data;
            } catch (error) {
                showLoading(false);
                throw error;
            }
        }

        // Authentication
        async function login(username, password) {
            try {
                const result = await makeAPIRequest('/api/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
                
                authToken = result.token;
                document.getElementById('authOverlay').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                showNotification('Successfully logged in!', 'success');
                
                // Load initial data
                loadPlayers();
                loadLobbies();
                
            } catch (error) {
                showNotification('Login failed: Invalid credentials', 'error');
            }
        }

        function logout() {
            authToken = null;
            document.getElementById('authOverlay').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            showNotification('Logged out successfully', 'info');
        }

        // Tournament Management
        async function createTournament(formData) {
            try {
                await makeAPIRequest('/api/tournaments', {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                showNotification('Tournament created successfully!', 'success');
                document.getElementById('tournamentForm').reset();
            } catch (error) {
                showNotification('Failed to create tournament', 'error');
            }
        }

        // Player Management
        async function addPlayer(playerData) {
            try {
                const result = await makeAPIRequest('/api/players', {
                    method: 'POST',
                    body: JSON.stringify(playerData)
                });
                showNotification('Player added successfully!', 'success');
                document.getElementById('playerForm').reset();
                loadPlayers(); // Refresh players list
            } catch (error) {
                showNotification('Failed to add player', 'error');
            }
        }

        async function loadPlayers() {
            try {
                // For demo, use sample data
                currentPlayers = [
                    { id: 1, username: 'dishsoap', displayName: 'dishsoap', region: 'NA', discordTag: 'dishsoap#1234', twitchUsername: 'dishsoap' },
                    { id: 2, username: 'souless', displayName: 'Souless', region: 'NA', discordTag: 'souless#5678', twitchUsername: 'souless' },
                    { id: 3, username: 'aespakarina', displayName: 'aespa karina', region: 'KR', discordTag: 'karina#9012', twitchUsername: 'aespakarina' }
                ];
                renderPlayersTable();
            } catch (error) {
                showNotification('Failed to load players', 'error');
            }
        }

        function renderPlayersTable() {
            const tbody = document.getElementById('playersTableBody');
            tbody.innerHTML = currentPlayers.map(player => `
                <tr>
                    <td class="px-4 py-3 font-medium">${player.displayName}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">${player.region}</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600">${player.discordTag || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600">${player.twitchUsername || '-'}</td>
                    <td class="px-4 py-3">
                        <button onclick="deletePlayer(${player.id})" class="btn-danger text-xs">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function deletePlayer(playerId) {
            if (confirm('Are you sure you want to delete this player?')) {
                try {
                    await makeAPIRequest(`/api/players/${playerId}`, { method: 'DELETE' });
                    showNotification('Player deleted successfully!', 'success');
                    loadPlayers();
                } catch (error) {
                    showNotification('Failed to delete player', 'error');
                }
            }
        }

        // Lobby Management
        async function createLobby(lobbyData) {
            try {
                await makeAPIRequest('/api/lobbies', {
                    method: 'POST',
                    body: JSON.stringify(lobbyData)
                });
                showNotification('Lobby created successfully!', 'success');
                document.getElementById('lobbyForm').reset();
                loadLobbies();
            } catch (error) {
                showNotification('Failed to create lobby', 'error');
            }
        }

        async function loadLobbies() {
            try {
                // For demo, use sample data
                currentLobbies = [
                    { id: 1, name: 'Lobby A', tournamentId: 1, gameNumber: 1, status: 'completed' },
                    { id: 2, name: 'Lobby B', tournamentId: 1, gameNumber: 1, status: 'completed' },
                    { id: 3, name: 'Lobby A', tournamentId: 1, gameNumber: 2, status: 'in_progress' }
                ];
                renderLobbiesTable();
                updateLobbySelects();
            } catch (error) {
                showNotification('Failed to load lobbies', 'error');
            }
        }

        function renderLobbiesTable() {
            const tbody = document.getElementById('lobbiesTableBody');
            tbody.innerHTML = currentLobbies.map(lobby => `
                <tr>
                    <td class="px-4 py-3 font-medium">${lobby.name}</td>
                    <td class="px-4 py-3">TFT World Championship 2025</td>
                    <td class="px-4 py-3">${lobby.gameNumber}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs ${
                            lobby.status === 'completed' ? 'bg-green-100 text-green-800' :
                            lobby.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-gray-100 text-gray-800'
                        }">${lobby.status.replace('_', ' ')}</span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="deleteLobby(${lobby.id})" class="btn-danger text-xs">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateLobbySelects() {
            const select = document.getElementById('resultsLobby');
            select.innerHTML = '<option value="">Select a lobby...</option>' +
                currentLobbies.map(lobby => 
                    `<option value="${lobby.id}">${lobby.name} - Game ${lobby.gameNumber}</option>`
                ).join('');
        }

        async function deleteLobby(lobbyId) {
            if (confirm('Are you sure you want to delete this lobby?')) {
                try {
                    await makeAPIRequest(`/api/lobbies/${lobbyId}`, { method: 'DELETE' });
                    showNotification('Lobby deleted successfully!', 'success');
                    loadLobbies();
                } catch (error) {
                    showNotification('Failed to delete lobby', 'error');
                }
            }
        }

        // Game Results Management
        function addResultRow() {
            const container = document.getElementById('resultsContainer');
            const index = container.children.length;
            
            const resultRow = document.createElement('div');
            resultRow.className = 'result-row';
            resultRow.innerHTML = `
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Player</label>
                        <select class="form-input text-sm" data-field="playerId" data-index="${index}">
                            <option value="">Select player...</option>
                            ${currentPlayers.map(player => 
                                `<option value="${player.id}">${player.displayName}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">Placement</label>
                        <input type="number" min="1" max="8" placeholder="1-8" class="form-input text-sm" data-field="placement" data-index="${index}">
                    </div>
                    <div class="flex items-end">
                        <button onclick="removeResultRow(this)" class="btn-danger text-xs">Remove</button>
                    </div>
                </div>
            `;
            
            container.appendChild(resultRow);
        }

        function removeResultRow(button) {
            button.closest('.result-row').remove();
        }

        async function submitResults() {
            const lobbyId = document.getElementById('resultsLobby').value;
            if (!lobbyId) {
                showNotification('Please select a lobby first', 'error');
                return;
            }

            const resultRows = document.querySelectorAll('.result-row');
            const results = [];

            let hasErrors = false;
            resultRows.forEach(row => {
                row.classList.remove('has-error');
                const playerId = row.querySelector('[data-field="playerId"]').value;
                const placement = row.querySelector('[data-field="placement"]').value;

                if (!playerId || !placement) {
                    row.classList.add('has-error');
                    hasErrors = true;
                    return;
                }

                // Calculate points based on placement (standard scoring)
                const pointsMap = { 1: 8, 2: 6, 3: 5, 4: 4, 5: 3, 6: 2, 7: 1, 8: 0 };
                const points = pointsMap[parseInt(placement)] || 0;

                results.push({
                    playerId: parseInt(playerId),
                    placement: parseInt(placement),
                    points: points
                });
            });

            if (hasErrors) {
                showNotification('Please fix errors in red-highlighted rows', 'error');
                return;
            }

            if (results.length === 0) {
                showNotification('Please add at least one result', 'error');
                return;
            }

            try {
                await makeAPIRequest('/api/game-results', {
                    method: 'POST',
                    body: JSON.stringify({ lobbyId: parseInt(lobbyId), results })
                });
                showNotification('Game results submitted successfully!', 'success');
                document.getElementById('resultsContainer').innerHTML = '';
                document.getElementById('resultsLobby').value = '';
            } catch (error) {
                showNotification('Failed to submit results', 'error');
            }
        }

        // Form Handlers
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            await login(username, password);
        });

        document.getElementById('tournamentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = {
                name: document.getElementById('tournamentName').value,
                description: document.getElementById('tournamentDescription').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                format: document.getElementById('tournamentFormat').value,
                status: document.getElementById('tournamentStatus').value
            };
            await createTournament(formData);
        });

        document.getElementById('playerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const playerData = {
                username: document.getElementById('playerUsername').value,
                displayName: document.getElementById('playerDisplayName').value,
                region: document.getElementById('playerRegion').value,
                discordTag: document.getElementById('playerDiscord').value,
                twitchUsername: document.getElementById('playerTwitch').value
            };
            await addPlayer(playerData);
        });

        document.getElementById('lobbyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const lobbyData = {
                name: document.getElementById('lobbyName').value,
                tournamentId: parseInt(document.getElementById('lobbyTournament').value),
                gameNumber: parseInt(document.getElementById('lobbyGameNumber').value),
                status: document.getElementById('lobbyStatus').value
            };
            await createLobby(lobbyData);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            
            // Add one initial result row
            addResultRow();
        });
    </script>
</body>
</html>